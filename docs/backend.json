{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a registered user of the platform, including their profile, referral, and geographical data.",
      "properties": {
        "uid": { "type": "string", "description": "Firebase Auth UID, serving as the document ID." },
        "name": { "type": "string", "description": "User's full name." },
        "email": { "type": "string", "description": "User's email address.", "format": "email" },
        "role": { "type": "string", "enum": ["User", "Super Admin", "User Management Admin", "Franchisee Management Admin"], "description": "The administrative or user role on the platform." },
        "status": { "type": "string", "enum": ["Active", "Pending", "Banned"], "default": "Active" },
        "isPaid": { "type": "boolean", "default": false, "description": "Indicates if the user has made an initial purchase." },
        "registeredAt": { "type": "string", "format": "date-time", "description": "Timestamp of registration." },
        
        "pgcBalance": { "type": "number", "default": 0, "description": "Current PGC token balance." },
        "usdBalance": { "type": "number", "default": 0, "description": "Current real USDT commission balance." },
        "totalCommission": { "type": "number", "default": 0, "description": "Lifetime commission earnings in USDT." },

        "referredByUserId": { "type": "string", "description": "The UID of the user who referred this user." },
        "referralCode": { "type": "string", "description": "This user's unique code to refer others." },
        "direct_team": { "type": "array", "items": { "type": "string" }, "description": "An array of UIDs of directly referred users." },
        "totalTeamSize": { "type": "number", "default": 0 },
        "paidTeamSize": { "type": "number", "default": 0 },
        "freeRank": { "type": "string", "default": "None" },
        "paidRank": { "type": "string", "default": "None" },
        
        "walletAddress": { "type": "string", "description": "The user's connected Solana wallet address." },

        "country": { "type": "string", "description": "User's country (normalized, lowercase)." },
        "state": { "type": "string", "description": "User's state/province (normalized, lowercase)." },
        "district": { "type": "string", "description": "User's district (normalized, lowercase)." },
        "taluka": { "type": "string", "description": "User's taluka/block (normalized, lowercase)." },
        "village": { "type": "string", "description": "User's village/ward (normalized, lowercase)." },
        "street": { "type": "string", "description": "User's street (normalized, lowercase)." }
      },
      "required": ["uid", "name", "email", "role", "status", "pgcBalance", "registeredAt"]
    },
    "Transaction": {
        "title": "Transaction",
        "type": "object",
        "description": "Logs every financial event for auditing. CRITICAL: Should only be created by backend functions.",
        "properties": {
            "userId": { "type": "string", "description": "User who is involved in the transaction (e.g., recipient of commission)." },
            "type": { "type": "string", "enum": ["COMMISSION", "RANK_REWARD", "WITHDRAWAL", "PRESALE_PURCHASE"], "description": "The type of transaction." },
            "amount": { "type": "number", "description": "Amount of currency." },
            "currency": { "type": "string", "enum": ["PGC", "USDT"], "description": "The currency of the transaction." },
            "timestamp": { "type": "string", "format": "date-time" },
            "details": {
                "type": "object",
                "properties": {
                    "fromUserId": { "type": "string" },
                    "fromUserName": { "type": "string" },
                    "level": { "type": "number" },
                    "rewardName": { "type": "string" },
                    "purchaseRef": { "type": "string" }
                }
            }
        },
        "required": ["userId", "type", "amount", "currency", "timestamp"]
    },
    "Application": {
        "title": "Application",
        "type": "object",
        "description": "Represents a user's application for a specific role, like a franchisee.",
        "properties": {
            "userId": { "type": "string" },
            "userName": { "type": "string" },
            "roleAppliedFor": { "type": "string", "description": "e.g., 'Franchisee'" },
            "businessType": { "type": "string", "description": "The specific business from the list of 134 types." },
            "status": { "type": "string", "enum": ["Pending", "Approved", "Rejected"], "default": "Pending" },
            "submittedAt": { "type": "string", "format": "date-time" },
            "reviewedAt": { "type": "string", "format": "date-time" },
            "adminNotes": { "type": "string" }
        },
        "required": ["userId", "roleAppliedFor", "status", "submittedAt"]
    },
    "Poll": {
      "title": "Poll",
      "type": "object",
      "description": "A poll for community voting, scoped to a geographical level.",
      "properties": {
        "title": { "type": "string" },
        "description": { "type": "string" },
        "geographyScope": { "type": "string", "enum": ["International", "National", "State", "District", "Taluka", "Village", "Street"] },
        "country": { "type": "string", "description": "Required if scope is not International." },
        "state": { "type": "string", "description": "Required for State level and below." },
        "district": { "type": "string" },
        "taluka": { "type": "string" },
        "village": { "type": "string" },
        "street": { "type": "string" },
        "options": { "type": "array", "items": { "type": "string" } },
        "createdAt": { "type": "string", "format": "date-time" },
        "createdBy": { "type": "string" }
      },
      "required": ["title", "geographyScope", "options", "createdAt", "createdBy"]
    },
    "Vote": {
      "title": "Vote",
      "type": "object",
      "description": "A user's vote on a specific poll.",
      "properties": {
        "pollId": { "type": "string" },
        "userId": { "type": "string" },
        "selectedOption": { "type": "string" },
        "agreementLevel": { "type": "number", "minimum": 0, "maximum": 100 },
        "votedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["pollId", "userId", "selectedOption", "votedAt"]
    },
    "Product": {
      "title": "Product",
      "type": "object",
      "description": "A product in the e-commerce marketplace.",
      "properties": {
        "name": { "type": "string" },
        "description": { "type": "string" },
        "price": { "type": "number" },
        "currency": { "type": "string", "enum": ["PGC", "USDT"] },
        "category": { "type": "string" },
        "sellerId": { "type": "string" },
        "imageUrl": { "type": "string" }
      },
      "required": ["name", "price", "currency", "sellerId"]
    },
    "Cart": {
      "title": "Cart",
      "description": "A user's shopping cart.",
      "type": "object",
      "properties": {
        "userId": { "type": "string" },
        "items": { 
          "type": "array", 
          "items": { 
            "type": "object",
            "properties": {
              "productId": { "type": "string" },
              "quantity": { "type": "number" }
            }
          }
        },
        "updatedAt": { "type": "string", "format": "date-time" }
      }
    },
    "Order": {
      "title": "Order",
      "type": "object",
      "description": "An e-commerce order.",
      "properties": {
        "userId": { "type": "string" },
        "items": { "type": "array" },
        "totalAmount": { "type": "number" },
        "currency": { "type": "string" },
        "status": { "type": "string", "enum": ["Pending", "Processing", "Shipped", "Delivered", "Cancelled"] },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["userId", "items", "totalAmount", "status", "createdAt"]
    },
    "QuizResult": {
      "title": "QuizResult",
      "type": "object",
      "description": "Record of a user's attempt at a quiz.",
      "properties": {
        "quizId": { "type": "string" },
        "userId": { "type": "string" },
        "score": { "type": "number" },
        "totalQuestions": { "type": "number" },
        "completedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["quizId", "userId", "score", "completedAt"]
    }
  },
  "firestore": {
    "structure": [
      { "path": "/users/{userId}", "definition": { "schema": { "$ref": "#/entities/User" } } },
      { "path": "/transactions/{transactionId}", "definition": { "schema": { "$ref": "#/entities/Transaction" } } },
      { "path": "/applications/{applicationId}", "definition": { "schema": { "$ref": "#/entities/Application" } } },
      { "path": "/polls/{pollId}", "definition": { "schema": { "$ref": "#/entities/Poll" } } },
      { "path": "/votes/{voteId}", "definition": { "schema": { "$ref": "#/entities/Vote" } } },
      { "path": "/products/{productId}", "definition": { "schema": { "$ref": "#/entities/Product" } } },
      { "path": "/carts/{userId}", "definition": { "schema": { "$ref": "#/entities/Cart" } } },
      { "path": "/orders/{orderId}", "definition": { "schema": { "$ref": "#/entities/Order" } } },
      { "path": "/quiz_results/{resultId}", "definition": { "schema": { "$ref": "#/entities/QuizResult" } } }
    ]
  }
}
