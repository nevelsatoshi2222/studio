
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a registered user of the platform, including their profile, role, and financial information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user (matches Firebase Auth UID)."
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the user on the platform.",
          "enum": ["User", "Influencer", "Franchisee", "Job Seeker", "User Management Admin", "Job Management Admin", "Franchisee Management Admin", "Social Media Management Admin", "Quiz Management Admin", "Super Admin"]
        },
        "street": { "type": "string", "description": "User's street address." },
        "village": { "type": "string", "description": "User's village or ward." },
        "block": { "type": "string", "description": "User's block or kasba." },
        "taluka": { "type": "string", "description": "User's taluka." },
        "district": { "type": "string", "description": "User's district." },
        "state": { "type": "string", "description": "User's state or province." },
        "country": { "type": "string", "description": "User's country." },
        "directIncome": {
          "type": "number",
          "description": "Income generated directly from the user's own activities or referrals."
        },
        "totalIncome": {
          "type": "number",
          "description": "Total income including earnings from the entire affiliate team tree."
        },
        "registeredAt": {
            "type": "string",
            "format": "date-time",
            "description": "The timestamp when the user registered."
        },
        "solanaWalletAddress": {
          "type": "string",
          "description": "The user's primary Solana wallet address for receiving PGC."
        },
        "withdrawalAddress": {
            "type": "string",
            "description": "The Solana wallet address specified by the user for a withdrawal."
        },
        "pgcBalance": {
            "type": "number",
            "description": "The user's in-app balance of PGC, before it is withdrawn to their wallet."
        },
        "referralCode": {
            "type": "string",
            "description": "The UID of the user who referred this user."
        }
      },
      "required": ["id", "name", "email", "role"]
    },
    "Referral": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Referral",
      "type": "object",
      "description": "Represents a user's affiliate marketing data, including their referral link and team structure.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this referral data."
        },
        "referralLink": {
          "type": "string",
          "description": "The unique affiliate link for the user.",
          "format": "uri"
        },
        "directReferrals": {
          "type": "array",
          "description": "A list of user IDs directly referred by this user.",
          "items": { "type": "string" }
        },
        "totalTeamSize": {
            "type": "number",
            "description": "The total number of users in the affiliate tree under this user."
        }
      },
      "required": ["userId", "referralLink"]
    },
    "SocialPost": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SocialPost",
      "type": "object",
      "description": "Represents a post made by a user on the social media hub.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the post." },
        "authorId": { "type": "string", "description": "The ID of the user who created the post." },
        "authorName": { "type": "string", "description": "The display name of the user who created the post." },
        "authorAvatar": { "type": "string", "description": "URL of the author's avatar image.", "format": "uri" },
        "content": { "type": "string", "description": "The text content of the post." },
        "imageUrl": { "type": "string", "description": "URL of an image attached to the post.", "format": "uri" },
        "timestamp": { "type": "string", "description": "When the post was created.", "format": "date-time" },
        "likes": { "type": "number", "description": "Number of likes on the post." },
        "comments": { "type": "number", "description": "Number of comments on the post." },
        "mentionsPgc": { "type": "boolean", "description": "True if the post mentions $PGC." },
        "mentionsIgc": { "type": "boolean", "description": "True if the post mentions $IGC." }
      },
      "required": ["authorId", "authorName", "content", "timestamp"]
    },
    "WithdrawalRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WithdrawalRequest",
      "type": "object",
      "description": "Represents a user's request to withdraw PGC from their in-app balance to their Solana wallet.",
      "properties": {
        "userId": { "type": "string", "description": "The ID of the user requesting the withdrawal." },
        "userName": { "type": "string", "description": "The name of the user." },
        "amount": { "type": "number", "description": "The amount of PGC requested." },
        "solanaAddress": { "type": "string", "description": "The destination Solana wallet address." },
        "requestedAt": { "type": "string", "description": "Timestamp of the request.", "format": "date-time" },
        "status": { "type": "string", "description": "The status of the withdrawal request.", "enum": ["pending", "completed", "failed"] }
      },
      "required": ["userId", "amount", "solanaAddress", "requestedAt", "status"]
    },
    "ForumPost": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ForumPost",
      "type": "object",
      "description": "A post in the governance forum.",
      "properties": {
        "title": { "type": "string" },
        "content": { "type": "string" },
        "authorId": { "type": "string" },
        "authorName": { "type": "string" },
        "authorAvatar": { "type": "string", "format": "uri" },
        "topic": { "type": "string" },
        "geography": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" },
        "upvotes": { "type": "number" },
        "comments": { "type": "number" }
      },
      "required": ["title", "content", "authorId", "authorName", "topic", "geography", "createdAt"]
    }
  },
  "auth": {
    "providers": ["password", "anonymous"]
  },
  "firestore": {
    "indexes": [
        {
            "collectionGroup": "users",
            "queryScope": "COLLECTION",
            "fields": [
                {
                    "fieldPath": "referralCode",
                    "order": "ASCENDING"
                },
                {
                    "fieldPath": "registeredAt",
                    "order": "DESCENDING"
                }
            ]
        },
        {
            "collectionGroup": "forums",
            "queryScope": "COLLECTION",
            "fields": [
                {
                    "fieldPath": "createdAt",
                    "order": "DESCENDING"
                }
            ]
        },
        {
            "collectionGroup": "social_posts",
            "queryScope": "COLLECTION",
            "fields": [
                {
                    "fieldPath": "timestamp",
                    "order": "DESCENDING"
                }
            ]
        }
    ],
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "schema": { "$ref": "#/entities/User" },
          "description": "Stores the public profile data and role for each user. The document ID is the user's UID from Firebase Auth."
        }
      },
      {
        "path": "/social_posts/{postId}",
        "definition": {
          "schema": { "$ref": "#/entities/SocialPost" },
          "description": "A top-level collection for all social media posts from all users."
        }
      },
       {
        "path": "/withdrawal_requests/{requestId}",
        "definition": {
          "schema": { "$ref": "#/entities/WithdrawalRequest" },
          "description": "Stores all user withdrawal requests for admin processing."
        }
      },
       {
        "path": "/forums/{postId}",
        "definition": {
          "schema": { "$ref": "#/entities/ForumPost" },
          "description": "Stores posts for the governance forum."
        }
      }
    ],
    "reasoning": "This structure centralizes the user's role within their main document, allowing for more flexible and granular security rules. Specific admins (e.g., 'User Management Admin') can be granted access to collections like '/users', while a 'Super Admin' has overarching permissions. This role-based access control (RBAC) is more scalable and secure than the previous existence-based check."
  }
}
