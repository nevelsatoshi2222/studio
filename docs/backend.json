
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a registered user of the platform, including their profile, role, and financial information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user (matches Firebase Auth UID)."
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the user on the platform.",
          "enum": ["User", "Influencer", "Franchisee", "Job Seeker", "Admin"]
        },
        "street": { "type": "string", "description": "User's street address." },
        "village": { "type": "string", "description": "User's village or ward." },
        "block": { "type": "string", "description": "User's block or kasba." },
        "taluka": { "type": "string", "description": "User's taluka." },
        "district": { "type": "string", "description": "User's district." },
        "state": { "type": "string", "description": "User's state or province." },
        "country": { "type": "string", "description": "User's country." },
        "directIncome": {
          "type": "number",
          "description": "Income generated directly from the user's own activities or referrals."
        },
        "totalIncome": {
          "type": "number",
          "description": "Total income including earnings from the entire affiliate team tree."
        },
        "registeredAt": {
            "type": "string",
            "format": "date-time",
            "description": "The timestamp when the user registered."
        },
        "solanaWalletAddress": {
          "type": "string",
          "description": "The user's primary Solana wallet address for receiving PGC."
        },
        "withdrawalAddress": {
            "type": "string",
            "description": "The Solana wallet address specified by the user for a withdrawal."
        },
        "pgcBalance": {
            "type": "number",
            "description": "The user's in-app balance of PGC, before it is withdrawn to their wallet."
        }
      },
      "required": ["id", "name", "email", "role"]
    },
    "Referral": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Referral",
      "type": "object",
      "description": "Represents a user's affiliate marketing data, including their referral link and team structure.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this referral data."
        },
        "referralLink": {
          "type": "string",
          "description": "The unique affiliate link for the user.",
          "format": "uri"
        },
        "directReferrals": {
          "type": "array",
          "description": "A list of user IDs directly referred by this user.",
          "items": { "type": "string" }
        },
        "totalTeamSize": {
            "type": "number",
            "description": "The total number of users in the affiliate tree under this user."
        }
      },
      "required": ["userId", "referralLink"]
    },
    "SocialPost": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SocialPost",
      "type": "object",
      "description": "Represents a post made by a user on the social media hub.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the post." },
        "userId": { "type": "string", "description": "The ID of the user who created the post." },
        "content": { "type": "string", "description": "The text content of the post." },
        "imageUrl": { "type": "string", "format": "uri", "description": "URL of an image attached to the post." },
        "timestamp": { "type": "string", "format": "date-time", "description": "When the post was created." },
        "likes": { "type": "number", "description": "Number of likes on the post." }
      },
      "required": ["id", "userId", "content", "timestamp"]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an administrator account with elevated privileges.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The UID of the user who is an admin."
        }
      },
      "required": ["userId"]
    },
    "WithdrawalRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WithdrawalRequest",
      "type": "object",
      "description": "Represents a user's request to withdraw PGC from their in-app balance to their Solana wallet.",
      "properties": {
        "userId": { "type": "string", "description": "The ID of the user requesting the withdrawal." },
        "userName": { "type": "string", "description": "The name of the user." },
        "amount": { "type": "number", "description": "The amount of PGC requested." },
        "solanaAddress": { "type": "string", "description": "The destination Solana wallet address." },
        "requestedAt": { "type": "string", "format": "date-time", "description": "Timestamp of the request." },
        "status": { "type": "string", "enum": ["pending", "completed", "failed"], "description": "The status of the withdrawal request." }
      },
      "required": ["userId", "amount", "solanaAddress", "requestedAt", "status"]
    }
  },
  "auth": {
    "providers": ["password", "anonymous"]
  },
  "firestore": {
    "rules": "rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Rule for the 'users' collection\n    match /users/{userId} {\n      // Allow a user to create their own document upon registration.\n      // - The person must be logged in (request.auth != null).\n      // - The document ID they are writing to must be their own UID.\n      allow create: if request.auth != null && request.auth.uid == userId;\n\n      // Allow a logged-in user to read and update their own document.\n      allow read, update: if request.auth != null && request.auth.uid == userId;\n    }\n\n    // Allow users to read their own admin role document\n    match /roles_admin/{userId} {\n      allow read: if request.auth.uid == userId;\n      allow write: if false; // Nobody should write to this directly from client\n    }\n\n    // Explicitly deny reads/writes to other collections unless specified\n    match /{document=**} {\n      allow read, write: if false;\n    }\n  }\n}",
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "schema": { "$ref": "#/entities/User" },
          "description": "Stores the public profile data for each user. The document ID is the user's UID from Firebase Auth."
        }
      },
      {
        "path": "/users/{userId}/referrals/data",
        "definition": {
          "schema": { "$ref": "#/entities/Referral" },
          "description": "A singleton document storing the referral data (link, team) for the parent user. This structure ensures a user can only access their own referral information."
        }
      },
      {
        "path": "/social_posts/{postId}",
        "definition": {
          "schema": { "$ref": "#/entities/SocialPost" },
          "description": "A top-level collection for all social media posts from all users."
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "schema": { "$ref": "#/entities/Admin" },
          "description": "An existence-based check for admin privileges. If a document exists with a user's UID, that user is an admin."
        }
      },
       {
        "path": "/withdrawal_requests/{requestId}",
        "definition": {
          "schema": { "$ref": "#/entities/WithdrawalRequest" },
          "description": "Stores all user withdrawal requests for admin processing."
        }
      }
    ],
    "reasoning": "This structure separates user profile data from their affiliate/referral data. Storing referral information in a subcollection of the user's document (/users/{userId}/referrals/data) allows for security rules that grant a user access only to their own referral tree and income data. Social posts are in a global collection for easy querying for the main feed. The 'roles_admin' collection provides a simple, secure way to manage administrator access. Withdrawal requests are in a separate top-level collection for easy admin review."
  }
}

    